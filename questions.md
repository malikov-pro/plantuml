Я проанализирую план разработки и текущее состояние проекта, чтобы определить, что нужно уточнить перед началом изменения кода.
Ran tool
Ran tool

Read file: plugins/plantuml/init.rb
Ran tool
Ran tool

Read file: plugins/plantuml/app/helpers/plantuml_helper.rb
Read file: plugins/plantuml/app/controllers/plantuml_controller.rb
Ran tool

Read file: plugins/plantuml/app/views/settings/_plantuml.html.erb
Read file: plugins/plantuml/config/routes.rb
Read file: plugins/plantuml/lib/tasks/cleanup.rake

Проанализировав план разработки и текущую архитектуру плагина, я выявил несколько важных моментов, которые требуют уточнения перед началом изменения кода:

## Критические расхождения между планом и реальностью

### 1. **Настройки плагина**
**Проблема**: В плане указано удаление настройки `plantuml_binary_path`, но в реальности используется `plantuml_binary_default`
- Текущая настройка: `'plantuml_binary_default'` 
- В плане: `plantuml_binary_path`

**Вопрос**: Как правильно называется настройка бинарного файла? Нужно ли сохранить обратную совместимость?

### 2. **Версионная совместимость**
**Проблема**: Конфликт версий Redmine в разных местах плана
- Текущий код: `requires_redmine version: '4.1'..'6.0'`
- В плане указано: `'2.6'..'4.1'` → `'5.0'..'6.1'`

**Вопросы**: 
- Нужно ли поддерживать Redmine 4.x или полностью переходить на 5.x+?
- Тестировалась ли совместимость с Redmine 6.0+?

### 3. **Структура URL и кодирование**
**Неясности в плане**:
- Не указан конкретный формат URL для PlantUML сервера
- Не определен алгоритм кодирования (deflate+base64 как в GitLab?)
- Не указано, как обрабатывать специальные символы

**Вопросы**:
- Какой точно формат URL использовать: `{server_url}/{format}/{encoded}` или `{server_url}/plantuml/{format}/{encoded}`?
- Использовать ли стандартное PlantUML кодирование (deflate+base64)?

### 4. **NGINX конфигурация**
**Проблема**: План предполагает настройку NGINX, но не указано:
- Кто и где будет настраивать NGINX?
- Входит ли это в задачи разработки плагина?
- Как быть с развертываниями без NGINX?

**Вопрос**: Должен ли плагин работать как с NGINX прокси, так и без него?

### 5. **Обратная совместимость диаграмм**
**Неопределенность**: 
- Как обеспечить 100% совместимость существующих диаграмм?
- Что делать с кэшированными изображениями?
- Миграция данных при обновлении плагина?

### 6. **Fallback стратегия**
**Отсутствует в плане**:
- Что показывать при недоступности PlantUML сервера?
- Как определять, что сервер недоступен?
- Timeout для запросов к серверу?

### 7. **Локализация**
**Не учтено**: В `_plantuml.html.erb` используются ключи локализации:
- `l(:allow_includes)`
- `l(:cache_expiration)` 
- `l(:plantuml_binary)`

**Вопрос**: Нужны ли новые ключи локализации для настройки сервера?

## Рекомендуемые уточнения перед началом

### Техническая архитектура:
1. **Определить точный формат URL** для PlantUML сервера
2. **Выбрать стратегию кодирования** диаграмм в URL
3. **Решить вопрос с NGINX** - обязателен или опционален?
4. **Определить fallback поведение** при недоступности сервера

### Совместимость:
1. **Согласовать версии Redmine** для поддержки (4.x, 5.x, 6.x?)
2. **Протестировать на целевых версиях** перед началом разработки  
3. **Определить стратегию миграции** существующих установок

### Функциональные требования:
1. **Уточнить UI/UX требования** - нужен ли превью редактор?
2. **Определить настройки безопасности** для PlantUML сервера
3. **Решить вопрос с кэшированием** на уровне приложения

### Тестирование:
1. **Настроить тестовый PlantUML сервер** для разработки
2. **Подготовить тестовые сценарии** для проверки совместимости
3. **Определить критерии acceptance** для каждой фазы

**Рекомендация**: Начать с Фазы 1.1, но сначала создать простой прототип URL генерации для проверки подхода на тестовом PlantUML сервере.